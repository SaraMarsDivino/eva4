<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Profesores</title>
    <script>
        const token = "568e73fa4e69f6b09bc5fabe542a8311faac79de";
        const endpointProfesores = "http://127.0.0.1:8000/api/profesores/";
        const endpointClases = "http://127.0.0.1:8000/api/clases/";

        function cargarProfesores() {
            fetch(endpointProfesores, { headers: { "Authorization": `Token ${token}` } })
            .then(response => response.json())
            .then(data => {
                const lista = document.getElementById("lista-profesores");
                lista.innerHTML = "";
                data.forEach(profesor => {
                    const clases = profesor.clases_impartidas.length > 0 
                        ? profesor.clases_impartidas.join(", ") 
                        : "Ninguna";
                    lista.innerHTML += `
                        <li>
                            ${profesor.nombre} - ${profesor.especialidad} (Clases: ${clases})
                            <button onclick="eliminarProfesor(${profesor.id})">Eliminar</button>
                        </li>
                    `;
                });
            });
        }

        function cargarClases() {
            fetch(endpointClases, { headers: { "Authorization": `Token ${token}` } })
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById("clases-impartidas");
                select.innerHTML = "";
                data.forEach(clase => {
                    select.innerHTML += `<option value="${clase.id}">${clase.nombre}</option>`;
                });
            });
        }

        function crearProfesor() {
            const nombre = document.getElementById("nombre").value;
            const especialidad = document.getElementById("especialidad").value;
            const clases = Array.from(document.getElementById("clases-impartidas").selectedOptions)
                                .map(option => parseInt(option.value));

            fetch(endpointProfesores, {
                method: "POST",
                headers: {
                    "Authorization": `Token ${token}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ nombre, especialidad, clases_impartidas: clases })
            }).then(() => {
                cargarProfesores();
                document.getElementById("form-profesor").reset();
            });
        }

        function eliminarProfesor(id) {
            fetch(`${endpointProfesores}${id}/`, {
                method: "DELETE",
                headers: { "Authorization": `Token ${token}` }
            }).then(() => cargarProfesores());
        }

        document.addEventListener("DOMContentLoaded", () => {
            cargarProfesores();
            cargarClases();
        });
    </script>
</head>
<body>
    <h1>CRUD de Profesores</h1>

    <form id="form-profesor" onsubmit="event.preventDefault(); crearProfesor();">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="especialidad" placeholder="Especialidad" required>
        <select id="clases-impartidas" multiple></select>
        <button type="submit">Guardar</button>
    </form>

    <h2>Lista de Profesores</h2>
    <ul id="lista-profesores"></ul>

    <a href="{% url 'menu' %}">ATR√ÅS</a>
</body>
</html>
