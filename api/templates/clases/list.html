<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD de Clases</title>
    <script>
        const token = "568e73fa4e69f6b09bc5fabe542a8311faac79de"; // Reemplaza con tu token
        const endpoint = "http://127.0.0.1:8000/api/clases/";

        function cargarClases() {
            fetch(endpoint, {
                method: "GET",
                headers: {
                    "Authorization": `Token ${token}`,
                    "Content-Type": "application/json"
                }
            })
            .then(response => {
                if (!response.ok) throw new Error("Error en el servidor");
                return response.json();
            })
            .then(data => {
                const listaClases = document.getElementById("lista-clases");
                listaClases.innerHTML = "";
                data.forEach(clase => {
                    const item = document.createElement("li");
                    item.innerHTML = `
                        ${clase.nombre} - ${clase.horario} - ${clase.descripcion}
                        <button onclick="editarClase(${clase.id})">Editar</button>
                        <button onclick="eliminarClase(${clase.id})">Eliminar</button>
                    `;
                    listaClases.appendChild(item);
                });
            })
            .catch(error => alert("Error al cargar las clases: " + error.message));
        }

        function crearClase() {
            const nombre = document.getElementById("nombre").value;
            const horario = document.getElementById("horario").value;
            const descripcion = document.getElementById("descripcion").value;

            fetch(endpoint, {
                method: "POST",
                headers: {
                    "Authorization": `Token ${token}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ nombre, horario, descripcion })
            })
            .then(response => {
                if (!response.ok) throw new Error("Error al crear la clase");
                cargarClases();
                document.getElementById("form-clase").reset();
            })
            .catch(error => alert("Error: " + error.message));
        }

        function editarClase(id) {
            const nombre = prompt("Nuevo Nombre:");
            const horario = prompt("Nuevo Horario:");
            const descripcion = prompt("Nueva Descripción:");

            fetch(`${endpoint}${id}/`, {
                method: "PUT",
                headers: {
                    "Authorization": `Token ${token}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ nombre, horario, descripcion })
            })
            .then(response => {
                if (!response.ok) throw new Error("Error al editar la clase");
                cargarClases();
            })
            .catch(error => alert("Error: " + error.message));
        }

        function eliminarClase(id) {
            if (!confirm("¿Estás seguro de eliminar esta clase?")) return;

            fetch(`${endpoint}${id}/`, {
                method: "DELETE",
                headers: {
                    "Authorization": `Token ${token}`,
                    "Content-Type": "application/json"
                }
            })
            .then(response => {
                if (!response.ok) throw new Error("Error al eliminar la clase");
                cargarClases();
            })
            .catch(error => alert("Error: " + error.message));
        }

        document.addEventListener("DOMContentLoaded", cargarClases);
    </script>
</head>
<body>
    <h1>CRUD de Clases</h1>
    <form id="form-clase" onsubmit="event.preventDefault(); crearClase();">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="time" id="horario" required>
        <input type="text" id="descripcion" placeholder="Descripción" required>
        <button type="submit">Guardar</button>
    </form>
    <ul id="lista-clases"></ul>
</body>
</html>
